" j138 .vimperatorrc

" Options
set history=1000
set activate=homepage,quickmark,tabopen,paste
set complete=tsl
set ignorecase
set hlsearch

" set chars for hint mode
set hintchars=asdfghjklqwertuiovbn
set focuscontent
set popups=tab

let mapleader = ","

" gui options
set gui=addons,bookmarks,nomenu,tabs,navigation
set animations=true
set visualbell
colorscheme indigo

hi StatusLine color:black; background:#ABD31B; font-weight:normal;

" Mappings
noremap j 5<C-e>
noremap k 5<C-y>
noremap J <PageDown>
noremap K <PageUp>
nnoremap h gT
nnoremap l gt
map <C-h> :tabmove! -1<CR>
map <C-l> :tabmove! +1<CR>

noremap U :undo<Space>
noremap <Leader>so :source ~/.vimperatorrc<CR>
noremap a <S-a>

noremap <Leader>es :set encoding=Shift_JIS<CR>
noremap <Leader>ec :set encoding=EUC-JP<CR>
noremap <Leader>eu :set encoding=UTF-8<CR>
noremap <Leader>ei :set encodeing=ISO-2022-JP<CR>

" toggle load css
noremap ! :set invum<CR>


" qmarks
qmark c http://www.google.com/calendar/render?pli=1
qmark e http://www.evernote.com/Home.action
qmark f http://www.facebook.com/
qmark l http://readitlaterlist.com/unread
qmark m https://mail.google.com/mail/
qmark n http://news.google.co.jp/nwshp?hl=ja&tab=wn
qmark r http://www.google.com/reader/view/
qmark t http://www.rememberthemilk.com/

" appendAnchor.js
let g:auto_append_anchor = "true"
let g:auto_append_anchor_once = "true"

"copy.js {{{
map <leader>y :copy<Space>TitleAndbittly<CR>
map <leader>Y :copy<Space>titleAndURL<CR>

javascript <<EOM
    liberator.globalVariables.copy_templates = [
    { label: 'titleAndURL',     value: '%TITLE% %URL%' },
    { label: 'title<cr>URL',   value: '%TITLE%\n%URL%' },
    { label: '[[title:URL]]',   value: '[[%TITLE%:%URL%]]' },
    { label: 'title',           value: '%TITLE%' },
    { label: 'url',             value: '%URL%' },
    { label: 'markdown',        value: '[%TITLE%](%URL% "%TITLE%")' },
    { label: 'htmlblockquote',  value: '<blockquote cite="%URL%" title="%TITLE%">%HTMLSEL%</blockquote>' },
    { label: 'bittly',          value: 'Get bittly URL', custom: function() { return util.httpGet('http://api.bitly.com/v3/shorten?login=j138&apiKey=R_3956b371cd906f5cb0bb5a326bf5165e&format=txt&longUrl=' + encodeURIComponent(buffer.URL)).responseText; }},
    { label: 'TitleAndbittly',  value: 'Get bittly URL', custom: function() { return buffer.title + ' ' + util.httpGet('http://api.bitly.com/v3/shorten?login=j138&apiKey=R_3956b371cd906f5cb0bb5a326bf5165e&format=txt&longUrl=' + encodeURIComponent(buffer.URL)).responseText; }},
    { label: 'ASIN',            value: 'ASIN code from amazon', custom: function(){return content.document.getElementById('ASIN').value;} },
    { label: 'Amazon',          value: 'simple amazon url', custom: function(){return 'http://amazon.co.jp/o/ASIN/' + content.document.getElementById('ASIN').value;} },
    { label: 'AmazonAffiliate', value: 'simple amazon url with affiliate', custom: function(){return 'http://amazon.co.jp/o/ASIN/' + content.document.getElementById('ASIN').value + '/mt03-22';} },
    ];
EOM
" }}}

" direct_bookmark.js
let g:direct_sbm_use_services_by_tag = "h"
let g:direct_sbm_use_services_by_post = "h"
noremap <S-a> :sbm<Space>[
noremap <Leader>V :bentry<CR>

" feedsomekey_3.js {{{
command! -nargs=+ lazy autocmd VimperatorEnter .* <args>
lazy fmaps -u='mail\.google\.com/mail' c / j k n p o u e x s r a y # [ ] ? gi gs gt gd ga gc
lazy fmaps -u='mail\.google\.com/mail/.*/[0-9a-f]+$' c / j,n k,p n,j p,k o u e x s r a y # [ ] ? gi gs gt gd ga gc
lazy fmaps -u='www\.google\.(com|co\.jp)/reader' -events=vkeypress j k n p m s v A r S N P X O gh ga gs gt gu u / ? J K
lazy fmaps -u='(fastladder|livedoor)\.com/reader' j k s a p o v c i,p <Space> <S-Space> z b < > q w e,g
lazy fmaps -u='https?://www\.rememberthemilk\.com/home/' j k m i c ? F,f G,g S,s L,l Y,y H,h M,m 1 2 3 4 5 <Del> <C-S-Left> <C-S-Right>
lazy fmaps -u='http://code.google.com/p/vimperator-labs/issues/list' o j k
lazy fmaps -u='http://code.google.com/p/vimperator-labs/issues/detail' u
" }}}

" hints-for-embedded.js
let g:hints_for_embedded_mode="e"

" localkeymode.js {{{
let g:localkeymode_enable = "true"

javascript <<EOM
liberator.globalVariables.localKeyMappings= [
    [/www\.nicovideo\.jp\/watch/, [
        ['p', ':stplay'],
        ['m', ':stmute'],
        ['R', ':strepeat'],
        ['c', ':stcomment'],
        ['s', ':stseek! +10'],
        ['S', ':stseek! -10'],
    ]],
    [/youtube\.com\/watch/, [
        ['p', ':stplay'],
        ['m', ':stmute'],
        ['R', ':strepeat'],
        ['s', ':stseek! +10'],
        ['S', ':stseek! -10'],
    ]],
];
EOM
" }}}

" ldrize_cooperation.js
noremap <Leader>l :toggleldrizecooperation<CR>
let g:ldrc_intelligence_bind = "true"
let g:ldrc_skip = "0.25"

" plugin_loader.js {{{
let g:plugin_loader_roots = "~/.vimperator/bundle/vimperator-plugins.git/"

javascript <<EOF
liberator.globalVariables.plugin_loader_plugins = <>
_libly
appendAnchor
auto-focus-frame
auto_detect_link
bitly
caret-hint
commandBookmarklet
cookieManager
copy
direct_bookmark
feedSomeKeys_3
feeder
google-plus-commando
hint-tombloo
hints-for-embedded
ldrize_cooperation
ldrize_cooperation_fetch_flv
localkeymode
multi_requester
open-frame
prevent-pseudo-domain
proxy
readitlater
sbmcommentsviewer
stella
stylish
tombloo
twittperator
usi
walk-input
x-hint
</>.toString().split(/\s+/).filter(function(n) n);
EOF
" }}}

" proxy.js {{{
javascript <<EOM

liberator.globalVariables.proxy_settings = [
{
    conf_name: 'disable',
    conf_usage: 'direct connection',
    settings: [
        {
            label: 'type',
            param: 0
        }
    ]
},
{
    conf_name: 'proxomitron',
    conf_usage: 'use internal proxy',
    settings: [
        {
            label: 'type',
            param: 1
        },
        {
            label: 'http',
            param: 'localhost'
        },
        {
            label: 'http_port',
            param: 8080
        }
    ]
},
{
    conf_name: 'proxy.pac',
    conf_usage: 'proxy.pac',
    settings: [
        {
            label: 'type',
            param: 2
       },
       {
            label: 'autoconfig_url',
            param: 'http://192.168.9.19/proxy.pac'
       },
    ]
},
{
	conf_name: 'tokyo-proxy.pac',
	conf_usage: 'tokyo-proxy.pac',
	settings: [
		{
			label: 'type',
			param: 2
		},
		{
			label: 'autoconfig_url',
			param: 'http://192.168.5.20/tokyo-proxy.pac'
		},
	]
}
];
EOM
" }}}

" readitlater.js
noremap s :readitlater<CR>

" sbmcommentsviewer.js
noremap <Leader>v :viewSBMComments<CR>

" toggle autopagerize
noremap <silent> <Leader>a :autopagerize<CR>

" multi_requester.js
noremap <Leader>d :mr alc<Space>
noremap <Leader>D :mr goo<Space>

" tumblr
nnoremap <Leader>t :mb pinned-or-current-node\ |\ Tombloo::Reblog\ |\ clear-pin<CR>

" Toggle Autopagerize {{{
javascript <<EOM
let (evaluateXPath = util.evaluateXPath || buffer.evaluateXPath) {
    commands.addUserCommand(
        ['autopagerize'],
        'Toggle AutoPagerize',
        function (args) {
            buffer.followLink(
                evaluateXPath('id("autopagerize_help")/div/a[@class="autopagerize_link"]').snapshotItem(0)
            );
        },
        {},
        true
    );
}
EOM
" }}}

" patch Greasemonkey 0.9.1 "{{{
js <<EOM
autocommands.add('VimperatorEnter', '.*',
  function() {
    let gm = Components.classes['@greasemonkey.mozdev.org/greasemonkey-service;1'];
    if (gm) {
      gm = gm.getService().wrappedJSObject;
      if (gm.injectScripts.toSource().search('sharedWindow') == -1) {
          gm.injectScripts = liberator.eval(
              gm.injectScripts.toSource()
                  .replace(/(?=var firebugConsole)/,
                          'var sharedWindow = {};' +
                          'sharedWindow.window = sharedWindow;' +
                          'sharedWindow.__proto__ = new XPCNativeWrapper(unsafeContentWin);')
                  .replace(/(?=sandbox\.__proto__)/, ' sandbox.window = sharedWindow;'),
              gm.injectScripts);
      }
    }
  });
EOM
"}}}

echo "done."

" vim: ts=2 sw=2 sts=2 fdm=marker ft=vimperator

